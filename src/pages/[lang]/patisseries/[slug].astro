---
export const prerender = true;

import Base from '../../../layouts/Base.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';
import FadeIn from '../../../components/FadeIn.astro';
import ParallaxImage from '../../../components/ParallaxImage.astro';
import { useTranslations, useTranslatedPath } from '../../../i18n/utils';

import project1 from '../../../assets/images/project-1.svg';
import project2 from '../../../assets/images/project-2.svg';
import project3 from '../../../assets/images/project-3.svg';

// Static paths for SSG - all language/slug combinations
export function getStaticPaths() {
  const languages = ['en', 'es', 'fr'];
  const slugs = ['wedding-cakes', 'artisan-pastries', 'celebration-desserts'];
  
  return languages.flatMap(lang => 
    slugs.map(slug => ({ params: { lang, slug } }))
  );
}

const { lang, slug } = Astro.params;
const t = useTranslations(lang as any);
const translatePath = useTranslatedPath(lang as any);

// Creation data with translation keys
type CreationData = {
  titleKey: string;
  categoryKey: string;
  styleKey: string;
  availabilityKey: string;
  descriptionKey: string;
  images: typeof project1[];
};

const creationsData: Record<string, CreationData> = {
  'wedding-cakes': {
    titleKey: 'creation.wedding',
    categoryKey: 'creation.wedding.category',
    styleKey: 'creation.wedding.style',
    availabilityKey: 'creation.wedding.availability',
    descriptionKey: 'creation.wedding.description',
    images: [project1, project2, project3],
  },
  'artisan-pastries': {
    titleKey: 'creation.artisan',
    categoryKey: 'creation.artisan.category',
    styleKey: 'creation.artisan.style',
    availabilityKey: 'creation.artisan.availability',
    descriptionKey: 'creation.artisan.description',
    images: [project2, project3, project1],
  },
  'celebration-desserts': {
    titleKey: 'creation.celebration',
    categoryKey: 'creation.celebration.category',
    styleKey: 'creation.celebration.style',
    availabilityKey: 'creation.celebration.availability',
    descriptionKey: 'creation.celebration.description',
    images: [project3, project1, project2],
  },
};

const creation = creationsData[slug as string];

if (!creation) {
  return Astro.redirect(translatePath('/patisseries'));
}

const title = t(creation.titleKey as any);
const category = t(creation.categoryKey as any);
const style = t(creation.styleKey as any);
const availability = t(creation.availabilityKey as any);
const description = t(creation.descriptionKey as any);
---

<Base 
  title={`${title} â€” L'Atelier`}
  description={description}
>
  <Header />
  
  <main class="pt-24">
    <!-- Hero -->
    <section class="py-20 px-6 lg:px-8">
      <div class="max-w-7xl mx-auto">
        <FadeIn>
          <nav class="mb-8">
            <a href={translatePath('/patisseries')} class="text-sm text-muted hover:text-foreground transition-colors">
              {t('creation.back')}
            </a>
          </nav>
        </FadeIn>
        
        <FadeIn delay={100}>
          <h1 class="uppercase tracking-wide">{title}</h1>
        </FadeIn>
        
        <FadeIn delay={200}>
          <div class="mt-8 flex flex-wrap gap-8 text-sm text-muted">
            <div>
              <span class="block text-xs uppercase tracking-widest mb-1">{t('creation.category.label')}</span>
              <span>{category}</span>
            </div>
            <div>
              <span class="block text-xs uppercase tracking-widest mb-1">{t('creation.style.label')}</span>
              <span>{style}</span>
            </div>
            <div>
              <span class="block text-xs uppercase tracking-widest mb-1">{t('creation.availability.label')}</span>
              <span>{availability}</span>
            </div>
          </div>
        </FadeIn>
      </div>
    </section>
    
    <!-- Main Image -->
    <section class="px-6 lg:px-8">
      <div class="max-w-7xl mx-auto">
        <FadeIn>
          <div class="aspect-[16/9] overflow-hidden">
            <ParallaxImage 
              src={creation.images[0]} 
              alt={title}
              class="h-full"
              speed={0.15}
            />
          </div>
        </FadeIn>
      </div>
    </section>
    
    <!-- Description -->
    <section class="py-20 px-6 lg:px-8">
      <div class="max-w-7xl mx-auto">
        <div class="max-w-2xl">
          <FadeIn>
            <p class="text-lg leading-relaxed text-muted">
              {description}
            </p>
          </FadeIn>
        </div>
      </div>
    </section>
    
    <!-- Gallery -->
    <section class="py-8 px-6 lg:px-8">
      <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          {creation.images.slice(1).map((image, index) => (
            <FadeIn delay={index * 100}>
              <div class="aspect-[4/3] overflow-hidden">
                <img 
                  src={image.src}
                  alt={`${title} - Image ${index + 2}`}
                  class="w-full h-full object-cover"
                  loading="lazy"
                />
              </div>
            </FadeIn>
          ))}
        </div>
      </div>
    </section>
    
    <!-- Navigation -->
    <section class="py-20 px-6 lg:px-8 border-t border-primary/10">
      <div class="max-w-7xl mx-auto">
        <div class="flex justify-between items-center">
          <a 
            href={translatePath('/patisseries')} 
            class="text-sm uppercase tracking-widest hover:opacity-70 transition-opacity"
          >
            {t('creation.all')}
          </a>
          <a 
            href={translatePath('/contact')} 
            class="text-sm uppercase tracking-widest hover:opacity-70 transition-opacity"
          >
            {t('creation.order')}
          </a>
        </div>
      </div>
    </section>
  </main>
  
  <Footer />
</Base>
